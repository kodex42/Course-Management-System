<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns="http://www.w3.org/1999/html" lang="en">
    <head th:insert="fragments.html :: head"></head>
    <body>
        <header th:insert="fragments.html :: nav"></header>
        <h2>Course info</h2>
        <table>
            <tr>
                <td>Course</td>
                <td>
                    <a th:href="@{/courses/{courseId}(courseId=${courseOffering.course.id})}" th:text="${courseOffering.course.code}"></a>
                </td>
            </tr>
            <tr>
                <td>Term</td>
                <td>
                    <a th:href="@{/terms/{termId}(termId=${courseOffering.term.id})}" th:text="${courseOffering.term}"></a>
                </td>
            </tr>
            <tr>
                <td>Professor</td>
                <td>
                    <a th:href="@{/users/{userId}(userId=${courseOffering.professor.id})}" th:text="|${courseOffering.professor.firstName} ${courseOffering.professor.lastName}|"></a>
                </td>
            </tr>
            <tr>
                <td>Capacity</td>
                <td th:text="${courseOffering.capacity}"></td>
            </tr>
            <tr th:if="${!courseOffering.students.isEmpty()}">
                <td>Students</td>
                <td>
                    <ul th:each="student: ${courseOffering.students}">
                        <li>
                            <a th:href="@{/users/{userId}(userId=${student.id})}" th:text="|${student.firstName} ${student.lastName}|"></a>
                        </li>
                    </ul>
                </td>
            </tr>
            <tr>
                <td sec:authorize="hasAuthority('PROFESSOR')">
                    <a th:href="@{/courses-offerings/{id}/deliverables/create(id=${courseOffering.id})}">Create deliverable</a>
                </td>
            </tr>
        </table>
        <br/>
        <h3>Deliverables</h3>
        <table>
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>Due date</th>
                <th>Description</th>
                <th>Instructions</th>
<!--                <th>Grade</th>-->
                <th>Action</th>
                <th></th>
            </tr>
            <tr th:each="deliv, iter : ${courseOffering.getDeliverables()}">
                <td th:text="${iter.count}"></td>
                <td th:text="${deliv.getName()}"></td>
                <td th:text="${deliv.getDeadline()}"></td>
                <td th:text="${deliv.getDescription()}"></td>
                <td th:if="${deliv.getFilename() != null}">
                    <a th:href="@{/courses-offerings/{courseOffrId}/deliverables/{delivId}/files/{file}(courseOffrId=${courseOffering.getId()}, delivId=${deliv.getId()}, file=${deliv.getFilename()})}">Download</a>
                </td>
<!--                <td  sec:authorize="hasAuthority('STUDENT')" >-->
<!--                    <form method="post" th:method="post" th:action="@{/applications/{id}/approve(id=${appl.getId()})}">-->
<!--                        <button type="submit">Approve</button>-->
<!--                    </form>-->
<!--                </td>-->
                <td sec:authorize="hasAuthority('PROFESSOR')">
                    <div>
                        <a th:href="@{/courses-offerings/{courseOffrId}/deliverables/{delivId}(
                        courseOffrId=${courseOffering.getId()},
                        delivId=${deliv.getId()})}">
                            Edit</a>
                    </div>
                </td>
                <td >
                    <form sec:authorize="hasAuthority('PROFESSOR')"
                          th:action="@{/courses-offerings/{courseOffrId}/deliverables/{delivId}(courseOffrId=${courseOffering.getId()}, delivId=${deliv.getId()})}"
                          th:method="DELETE">
                        <button type="submit">Delete</button>
                    </form>
                    <form sec:authorize="hasAuthority('PROFESSOR')"
                          th:action="@{/courses-offerings/{courseOffrId}/deliverables/{delivId}(courseOffrId=${courseOffering.getId()}, delivId=${deliv.getId()})}"
                          th:method="POST">
                        <button type="submit">Submit</button>
                    </form>
                </td>
            </tr>
        </table>
        <form sec:authorize="hasAuthority('ADMIN')" th:action="@{/course_offerings/{courseOffering}(courseOffering=${courseOffering.id})}" th:method="DELETE">
            <button type="submit">Delete course offering</button>
        </form>
        <form sec:authorize="hasAuthority('STUDENT')" th:if="${!registered}" th:action="@{/course_offerings/{courseOffering}/register(courseOffering=${courseOffering.id})}" th:method="POST">
            <button type="submit">Register</button>
        </form>

    </body>
</html>